<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gesti√≥n de Pacientes - Cl√≠nica Paula Gilabert</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background-color: #fffafc;
    color: #444;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    height: 100vh;
    overflow: hidden;
  }

  #app {
    display: flex;
    width: 95vw;
    max-width: 1600px;
    margin: auto;
    box-sizing: border-box;
  }

  table {
    border-collapse: collapse;
    width: 70%;
    table-layout: fixed;
    background: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    border-radius: 10px;
    overflow: hidden;
  }

  th, td {
    border: 1px solid #e2e2e2;
    padding: 10px;
    text-align: left;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  th {
    background-color: #f9e6eb;
  }

  #panel {
    width: 30%;
    background: #fff;
    border-left: 2px solid #ddd;
    box-shadow: -2px 0 8px rgba(0,0,0,0.05);
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  input, select, textarea {
    width: 100%;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }

  button {
    padding: 10px 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }

  .editar {
    background-color: #f7c9d4;
    color: #333;
    font-weight: 600;
    font-size: 14px;
    transition: 0.2s;
  }

  .editar:hover {
    background-color: #f3aebb;
  }

  .acciones button {
    margin-right: 5px;
  }

  #banner {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #f7c9d4;
    color: #333;
    padding: 10px 20px;
    border-radius: 20px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    display: none;
  }
</style>
</head>
<body>
<div id="app">
  <table id="tablaPacientes">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Tel√©fono</th>
        <th>Tratamiento</th>
        <th>Mes</th>
        <th>Cita</th>
        <th>Notas</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="panel">
    <input id="nombre" placeholder="Nombre" />
    <input id="telefono" placeholder="Tel√©fono" />
    <input id="tratamiento" placeholder="Tratamiento" />
    <input id="mes" placeholder="Mes" />
    <select id="cita">
      <option value="Pendiente">Pendiente</option>
      <option value="Citad@">Citad@</option>
    </select>
    <textarea id="notas" placeholder="Notas"></textarea>
    <button id="agregar">Agregar / Actualizar</button>
    <button id="exportar">Descargar Backup</button>
    <button id="importar">Importar Backup</button>
  </div>
</div>
<div id="banner"></div>

<script>
let pacientes = JSON.parse(localStorage.getItem('pacientes')) || [];
const tabla = document.querySelector('#tablaPacientes tbody');
const banner = document.getElementById('banner');

function mostrarBanner(texto) {
  banner.textContent = texto;
  banner.style.display = 'block';
  setTimeout(()=>banner.style.display='none',3000);
}

function renderTabla() {
  tabla.innerHTML = '';
  pacientes.forEach((p, i) => {
    const fila = document.createElement('tr');
    fila.innerHTML = `
      <td>${p.nombre}</td>
      <td>${p.telefono}</td>
      <td>${p.tratamiento}</td>
      <td>${p.mes}</td>
      <td>${p.cita}</td>
      <td>${p.notas}</td>
      <td class='acciones'><button class='editar' onclick='editarPaciente(${i})'>‚úèÔ∏è Editar</button></td>`;
    tabla.appendChild(fila);
  });
}

function guardarLocal() {
  localStorage.setItem('pacientes', JSON.stringify(pacientes));
}

document.getElementById('agregar').onclick = () => {
  const nombre = nombreInput.value.trim();
  const telefono = telefonoInput.value.trim();
  const tratamiento = tratamientoInput.value.trim();
  const mes = mesInput.value.trim();
  const cita = citaInput.value;
  const notas = notasInput.value.trim();

  if (!nombre) return;
  if (editIndex >= 0) {
    pacientes[editIndex] = { nombre, telefono, tratamiento, mes, cita, notas };
    editIndex = -1;
  } else {
    pacientes.push({ nombre, telefono, tratamiento, mes, cita, notas });
  }
  guardarLocal();
  renderTabla();
  mostrarBanner('‚úÖ Paciente guardado');
  document.querySelectorAll('#panel input, #panel textarea').forEach(e=>e.value='');
};

function editarPaciente(i) {
  const p = pacientes[i];
  nombreInput.value = p.nombre;
  telefonoInput.value = p.telefono;
  tratamientoInput.value = p.tratamiento;
  mesInput.value = p.mes;
  citaInput.value = p.cita;
  notasInput.value = p.notas;
  editIndex = i;
}

// Backup Export
const exportarBtn = document.getElementById('exportar');
exportarBtn.onclick = () => {
  const csv = 'Nombre,Tel√©fono,Tratamiento,Mes,Cita,Notas\n' + pacientes.map(p=>`${p.nombre},${p.telefono},${p.tratamiento},${p.mes},${p.cita},${p.notas}`).join('\n');
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'backup_pacientes.csv';
  a.click();
  mostrarBanner('üì¶ Backup descargado');
};

// Backup Import
const importarBtn = document.getElementById('importar');
importarBtn.onclick = () => {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.csv';
  input.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = evt => {
      const lines = evt.target.result.split(/\r?\n/).slice(1);
      pacientes = lines.filter(l=>l.trim()).map(l=>{
        const [nombre,telefono,tratamiento,mes,cita,notas] = l.split(',');
        return { nombre, telefono, tratamiento, mes, cita, notas };
      });
      guardarLocal();
      renderTabla();
      mostrarBanner('‚úÖ Backup importado y reemplazado');
    };
    reader.readAsText(file, 'UTF-8');
  };
  input.click();
};

let editIndex = -1;
const nombreInput = document.getElementById('nombre');
const telefonoInput = document.getElementById('telefono');
const tratamientoInput = document.getElementById('tratamiento');
const mesInput = document.getElementById('mes');
const citaInput = document.getElementById('cita');
const notasInput = document.getElementById('notas');

renderTabla();
</script>
</body>
</html>
