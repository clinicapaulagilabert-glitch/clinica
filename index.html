<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Listado pacientes ¬∑ Cl√≠nica Paula Gilabert</title>
<style>
:root{--bg:#f7eef2;--card:#fff5f7;--accent:#cfa3a9;--accent-2:#e9d7db;--muted:#8B6B6F;--text:#3b2b2d}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;background:linear-gradient(180deg,var(--bg),#fbf5f6);color:var(--text);-webkit-font-smoothing:antialiased}
.container{width:98vw;max-width:1600px;margin:8px auto;padding:8px}
.app{background:linear-gradient(180deg,var(--card),#fff);border-radius:12px;padding:12px;box-shadow:0 8px 30px rgba(203,164,169,0.08);border:1px solid rgba(207,163,169,0.08)}
.header{display:flex;gap:12px;align-items:center;margin-bottom:12px}
.logo{width:52px;height:52px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
.title{margin:0;font-size:18px}
.lead{margin:0;color:var(--muted);font-size:13px}
.layout{display:flex;gap:16px;min-height:70vh}
.left{flex:1 1 auto;min-width:0}
.right{flex:0 0 30%;min-width:260px;max-width:360px}
.controls{position:sticky;top:0;z-index:5;background:linear-gradient(180deg,var(--card),#fff);padding-bottom:6px;margin-bottom:6px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;border-bottom:1px dashed rgba(150,120,125,0.12)}
input[type=text],select,textarea{padding:8px;border-radius:10px;border:1px solid rgba(150,120,125,0.12);background:rgba(255,255,255,0.95);width:100%}
button{background:var(--accent);border:none;color:white;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
button.ghost{background:transparent;border:1px solid rgba(150,120,125,0.12);color:var(--text);padding:6px 10px}
.table-wrap{border-radius:10px;border:1px solid rgba(207,163,169,0.06);background:linear-gradient(#fff,#fffafc);overflow:auto}
.table-wrap::-webkit-scrollbar{height:10px;width:10px}
.table-wrap::-webkit-scrollbar-thumb{background:rgba(150,120,125,0.25);border-radius:8px}
table{min-width:920px;width:100%;border-collapse:collapse;table-layout:fixed}
th,td{padding:8px 6px;text-align:left;font-size:12px;border-bottom:1px dashed rgba(150,120,125,0.06);vertical-align:middle;word-break:break-word}
th{color:var(--muted);font-weight:700;background:#fff5f8;position:sticky;top:0;z-index:2}
tr.row-sent{background:rgba(120,200,120,0.12)}
tr.row-pending{background:rgba(255,210,80,0.14)}
tr.row-confirmed{background:rgba(120,120,120,0.05)}
.pill{display:inline-block;padding:6px 8px;border-radius:999px;background:#fff;border:1px solid rgba(207,163,169,0.18);color:var(--accent);font-weight:700}
.card{background:linear-gradient(180deg,#fff,#fffafc);padding:12px;border-radius:10px;border:1px solid rgba(207,163,169,0.06)}
.small{font-size:12px;color:var(--muted)}
.note{font-size:12px;color:var(--muted);margin-top:8px}
.right-panel{background:var(--card);padding:14px;border-radius:10px;border:1px solid rgba(200,200,200,0.9);box-shadow:0 10px 26px rgba(0,0,0,0.18)}
.banner{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:#fff;border:1px solid rgba(207,163,169,0.12);padding:10px 14px;border-radius:10px;box-shadow:0 8px 30px rgba(203,164,169,0.12);display:none;z-index:999}
.spinner{width:16px;height:16px;border-radius:50%;border:3px solid rgba(207,163,169,0.25);border-top-color:var(--accent);animation:spin 1s linear infinite;display:inline-block;vertical-align:middle;margin-right:8px}
@keyframes spin{to{transform:rotate(360deg)}}
button.edit{background:var(--accent);color:white;padding:6px 10px;border-radius:8px;font-weight:700;font-size:13px}
.order-bar{display:flex;justify-content:flex-end;align-items:center;gap:8px;margin:6px 0}
@media (max-width:980px){.layout{flex-direction:column}.right{order:2;max-width:100%;min-width:100%}.table-wrap{overflow-x:auto}}
</style>
</head>
<body>
<script src="https://apis.google.com/js/api.js"></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<div class="container">
  <div class="app">
    <div class="header">
      <div class="logo">CL</div>
      <div>
        <h1 class="title">Listado de pacientes ¬∑ Cl√≠nica Paula Gilabert</h1>
        <p class="lead">Protegido ¬∑ Drive sincronizado ¬∑ Import/Export CSV ¬∑ Env√≠o WhatsApp</p>
      </div>
    </div>
    <div class="layout">
      <div class="left">
        <div class="controls">
          <input id="search" type="text" placeholder="Buscar..." style="flex:1;min-width:180px" />
          <select id="filterMonth"><option value="">Mes</option><option>Enero</option><option>Febrero</option><option>Marzo</option><option>Abril</option><option>Mayo</option><option>Junio</option><option>Julio</option><option>Agosto</option><option>Septiembre</option><option>Octubre</option><option>Noviembre</option><option>Diciembre</option></select>
          <select id="filterCita"><option value="">Cita</option><option>Confirmada</option><option>Pendiente</option></select>
          <label><input id="selectAll" type="checkbox"> Todos</label>
          <button id="sendSelected">WhatsApp</button>
          <button id="downloadCSV" class="ghost">CSV</button>
          <button id="importBtn" class="ghost">üìÇ Importar</button>
        </div>
        <div class="order-bar">
          <span class="small">Ordenar:</span>
          <select id="orderBy">
            <option value="fechaAsc">Fecha ‚Üë</option>
            <option value="fechaDesc">Fecha ‚Üì</option>
            <option value="nombreAsc">Nombre A-Z</option>
          </select>
        </div>
        <div id="counter" class="small note">Mostrando 0</div>
        <div id="tableWrap" class="table-wrap card">
          <table id="patientsTable">
            <thead><tr>
              <th></th><th>Nombre</th><th>Tel√©fono</th><th>Tratamiento</th><th>Mes</th><th>Cita</th><th>Notas</th><th>Enviado</th><th>Acciones</th><th>Fecha</th>
            </tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div class="right">
        <div class="right-panel">
          <input id="name" placeholder="Nombre" />
          <input id="phone" placeholder="Tel√©fono" />
          <input id="treatment" placeholder="Tratamiento" />
          <select id="month"><option value="">Mes</option><option>Enero</option><option>Febrero</option><option>Marzo</option><option>Abril</option><option>Mayo</option><option>Junio</option><option>Julio</option><option>Agosto</option><option>Septiembre</option><option>Octubre</option><option>Noviembre</option><option>Diciembre</option></select>
          <select id="cita"><option>Confirmada</option><option>Pendiente</option></select>
          <textarea id="notes" placeholder="Notas"></textarea>
          <button id="save">Guardar</button>
          <textarea id="template">Hola {{nombre}}, ya tenemos los d√≠as disponibles del mes de {{mes}}, dime si prefieres la cita por la ma√±ana o la tarde. Un saludo.</textarea>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="bottomBanner" class="banner"></div>
<input id="fileInput" type="file" accept=".csv" style="display:none" />
<script>
(function(){ const PASSWORD='clinica2025'; const p = prompt('Contrase√±a:'); if(p !== PASSWORD){ document.body.innerHTML='<h1>Acceso denegado</h1>'; throw new Error('No access'); }})();
const $=s=>document.querySelector(s);
function uid(){return Date.now().toString(36)+Math.random().toString(36).substr(2,5)}
let patients=JSON.parse(localStorage.getItem('clinica_pacientes_v8')||'[]');
// MIGRACI√ìN: asignar id si falta
patients.forEach(p=>{ if(!p.id){ p.id=uid(); }});
localStorage.setItem('clinica_pacientes_v8',JSON.stringify(patients));
let editingIndex=null;const selectedIds=new Set();
function render(){const tbody=$('#patientsTable tbody');tbody.innerHTML='';patients.forEach(p=>{const checked=selectedIds.has(p.id)?'checked':'';const tr=document.createElement('tr');tr.innerHTML=`<td><input class='sel' type='checkbox' data-id='${p.id}' ${checked}></td>
<td>${p.name||''}</td><td>${p.phone||''}</td><td>${p.treatment||''}</td><td>${p.month||''}</td><td>${p.cita||''}</td><td>${p.notes||''}</td><td>${p.sent?"‚úîÔ∏è":""}</td>
<td><button class='edit' data-id='${p.id}'>‚úèÔ∏è</button></td><td>${new Date(p.createdAt||Date.now()).toLocaleString()}</td>`;tbody.appendChild(tr);});$('#counter').textContent=`${patients.length} pacientes`;}
$('#patientsTable').addEventListener('click',e=>{const b=e.target.closest('button.edit');if(b){const id=b.dataset.id;const i=patients.findIndex(pp=>pp.id===id);if(i>=0)startEdit(i);}});
function startEdit(i){editingIndex=i;const p=patients[i];$('#name').value=p.name||'';$('#phone').value=p.phone||'';$('#treatment').value=p.treatment||'';$('#month').value=p.month||'';$('#cita').value=p.cita||'Confirmada';$('#notes').value=p.notes||'';}
$('#save').onclick=()=>{const p={id:editingIndex!=null?patients[editingIndex].id:uid(),name:$('#name').value,phone:$('#phone').value,treatment:$('#treatment').value,month:$('#month').value,cita:$('#cita').value,notes:$('#notes').value,sent:false,createdAt:editingIndex!=null?patients[editingIndex].createdAt:new Date().toISOString()};if(editingIndex!=null){patients[editingIndex]=p;editingIndex=null;}else{patients.push(p);}localStorage.setItem('clinica_pacientes_v8',JSON.stringify(patients));render();};
render();
</script>
</body>
</html>